!function(){var r=angular.module("solitaire",["card","foundation","stock","templates","waste","pile"]);r.controller("SolitaireGameController",["Stock","Foundation","Waste","Pile","Card","$scope",function(r,a,t,o,n,e){var c=this,i=4,s=7,d=new n,u=0;c.cardLookup=[];for(var l=d.minRank;l<=d.maxRank;l++)d.suits.forEach(function(r){c.cardLookup.push(new n(l,r,u,(void 0))),u++});var f=_.shuffle(c.cardLookup.slice());for(c.piles=new Array(s),p=0;p<s;p++)c.piles[p]=new o(f.splice(0,p+1),p);c.stock=new r(f),c.waste=new t,c.foundations=new Array(i);for(var p=0;p<i;p++)c.foundations[p]=new a(p);e.$on("cardDrop",function(r,a,t){var o=a.split("-"),n=o[0],i=parseInt(o[1]);o=t.split("-");var s=o[0],d=parseInt(o[1]);if("card"!=n)throw"Invalid drop";var u=c.cardLookup[i];switch(s){case"foundation":c.foundations[d].maybeAddCards(u.location.maybeRemoveCards(u));break;case"pile":c.piles[d].maybeAddCards(u.location.maybeRemoveCards(u));break;default:throw"Invalid drop"}e.$apply()}),e.$on("cardDoubleClick",function(r,a){for(var t=c.cardLookup[a],o=0;o<c.foundations.length&&!c.foundations[o].maybeAddCards(t.location.maybeRemoveCards(t));o++);e.$apply()}),e.$on("drawCard",function(r,a){if("EMPTY"===a){var t=c.waste.maybeRemoveCards(c.waste.cards[0]);c.stock.maybeAddCards(t)}else{var o=c.cardLookup[a];c.waste.maybeAddCards(o.location.maybeRemoveCards(o))}e.$apply()})}])}(),function(){var r=angular.module("card",[]);r.directive("card",function(){var r=function(r,a,t){a.on("dblclick",function(a){r.$emit("cardDoubleClick",r.card.id)}),$(a).draggable({revert:!0,zIndex:10}),r["class"]=function(){return r.card.faceUp?r.card.shortName():"pcard-back"}};return{link:r,replace:!0,restrict:"E",scope:{card:"="},templateUrl:"app/card/card.html"}}),r.factory("Card",function(){var r=function(r,a,t,o){this.rank=r,this.suit=a,this.id=t,this.location=o,this.faceUp=!0};return r.prototype.isRed=function(){return"D"==this.suit||"H"==this.suit},r.prototype.minRank=1,r.prototype.maxRank=13,r.prototype.suits=["C","D","H","S"],r.prototype.shortName=function(){var r="pcard-";switch(this.rank){case 1:r+="A";break;case 11:r+="J";break;case 12:r+="Q";break;case 13:r+="K";break;default:r+=this.rank}return r+=this.suit,r.toLowerCase()},r})}(),function(){var r=angular.module("foundation",[]);r.factory("Foundation",function(){var r=function(r){this.cards=[],this.id=r,this.lock=!1};return r.prototype.maybeRemoveCards=function(r){var a=this;if(a.lock)throw"Foundation waiting for card removal to be completed.";return r==a.cards[a.cards.length-1]?(a.lock=!0,{cards:[a.cards[a.cards.length-1]],onMove:function(){a.cards.pop(),a.lock=!1},onReturn:function(){a.lock=!1}}):{cards:[],onMove:function(){},onReturn:function(){}}},r.prototype.maybeAddCards=function(r){return 1===r.cards.length&&(0===this.cards.length&&r.cards[0].rank===r.cards[0].minRank||this.cards.length>0&&r.cards[0].rank===this.cards[this.cards.length-1].rank+1&&r.cards[0].suit===this.cards[this.cards.length-1].suit)?(this.cards.push(r.cards[0]),r.cards[0].location=this,r.onMove(),!0):(r.onReturn(),!1)},r}),r.directive("foundation",function(){var r=function(r,a,t){$(a).droppable({drop:function(a,t){r.$emit("cardDrop",t.draggable.attr("id"),"foundation-"+r.foundation.id)}})};return{link:r,replace:!0,restrict:"E",scope:{foundation:"=",drop:"&"},templateUrl:"app/foundation/foundation.html"}})}(),function(){var r=angular.module("stock",["card"]);r.factory("Stock",["Card",function(r){var a=function(r){var a=this;a.cards=r.slice(),a.cards.forEach(function(r){r.location=a}),a.lock=!1};return a.prototype.maybeRemoveCards=function(r){var a=this;if(a.lock)throw"stock waiting for card removal to be completed.";var t={cards:[],onMove:function(){},onReturn:function(){}};return r===this.cards[this.cards.length-1]&&(a.lock=!0,t.cards.push(a.cards[a.cards.length-1]),t.onMove=function(){a.cards.pop(),a.lock=!1},t.onReturn=function(){a.lock=!1}),t},a.prototype.maybeAddCards=function(r){var a=this;return 0===a.cards.length&&r.cards.length>0?(a.cards=r.cards.slice().reverse(),a.cards.forEach(function(r){r.location=a}),r.onMove(),!0):(r.onReturn(),!1)},a}]),r.directive("stock",["$document",function(r){var a=function(a,t,o){function n(){var r=a.stock.cards;a.$emit("drawCard",r.length>0?r[r.length-1].id:"EMPTY")}r.bind("keydown",function(r){" "===r.key&&(n(),r.preventDefault())}),t.on("click",n)};return{link:a,replace:!0,restrict:"E",scope:{stock:"="},templateUrl:"app/stock/stock.html"}}])}(),function(){var r=angular.module("pile",["card"]);r.factory("Pile",["Card",function(r){var a=new r,t=function(r,a){var t=this;r?(t.faceDownCards=r.slice(),t.faceDownCards.forEach(function(r){r.location=t,r.faceUp=!1})):t.faceDownCards=[],t.cards=[],t.id=a,t.lock=!1,t.revealCard()};t.prototype.revealCard=function(){if(this.faceDownCards.length>0&&0===this.cards.length){var r=this.faceDownCards.pop();r.faceUp=!0,this.cards.push(r)}},t.prototype.maybeRemoveCards=function(r){var a=this;if(a.lock)throw"pile waiting for card removal to be completed.";var t={cards:[],onMove:function(){},onReturn:function(){}},o=a.cards.indexOf(r);return o>=0&&(a.lock=!0,t.cards=a.cards.slice(o,a.cards.length),t.onMove=function(){0===o?a.cards=[]:a.cards=a.cards.slice(0,o),a.lock=!1},t.onReturn=function(){a.lock=!1}),t};var o=function(r){if(r.length<=1)return!0;for(var a=1;a<r.length;a++)if((r[a].isRed()?r[a-1].isRed():!r[a-1].isRed())||r[a].rank!==r[a-1].rank-1)return!1;return!0};return t.prototype.maybeAddCards=function(r){var t=this;return r.cards.length>0&&o(t.cards.concat(r.cards))&&(r.cards[0].rank===a.maxRank||t.cards.length>0)?(r.cards.forEach(function(r){r.location=t}),t.cards=t.cards.concat(r.cards),r.onMove(),!0):(r.onReturn(),!1)},t}]),r.directive("pile",function(){var r=function(r,a,t){$(a).droppable({drop:function(a,t){r.$emit("cardDrop",t.draggable.attr("id"),"pile-"+r.pile.id)}})};return{link:r,replace:!0,restrict:"E",scope:{pile:"="},templateUrl:"app/pile/pile.html"}})}(),function(){var r=angular.module("waste",[]);r.factory("Waste",["Card",function(r){var a=function(){this.cards=[],this.lock=!1};return a.prototype.maybeRemoveCards=function(r){var a=this;if(a.lock)throw"Waste waiting for card removal to be completed.";var t={cards:[],onMove:function(){},onReturn:function(){}};return 0!==a.cards.length&&r?(r===a.cards[a.cards.length-1]?(a.lock=!0,t.cards.push(a.cards[a.cards.length-1]),t.onMove=function(){a.cards.pop(),a.lock=!1},t.onReturn=function(){a.lock=!1}):r===a.cards[0]&&(a.lock=!0,t.cards=a.cards.slice(),t.onMove=function(){a.cards=[],a.lock=!1},t.onReturn=function(){a.lock=!1}),t):t},a.prototype.maybeAddCards=function(r){return 1===r.cards.length?(this.cards.push(r.cards[0]),r.cards[0].location=this,r.onMove(),!0):(r.onReturn(),!1)},a}]),r.directive("waste",function(){return{replace:!0,restrict:"E",scope:{waste:"="},templateUrl:"app/waste/waste.html"}})}();null//# sourceMappingURL=main.min.js.mapnull